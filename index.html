<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Pizza Dough Calculator</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

</head>

<body>
    <nav class="navbar navbar-light bg-light">
        <span class="navbar-brand mb-0 h1">Pizza Dough Calculator</span>
        <form class="form-inline">
            <button class="btn btn-sm btn-outline-secondary" type="button" id="toggle">Wake Lock is disabled</button>
        </form>
    </nav>
    <div class="container">
        <div class="row mt-3">
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-sm">
                    <tr>
                        <td>Thickness Factor</td>
                        <td colspan=7>
                            <input type="number" class="form-control" placeholder="0" step="any" id="thicknessFactor">
                        </td>
                    </tr>
                    <tr>
                        <td>Shape</td>
                        <td colspan=7>
                            <div class="form-group">
                                <select id="shape" class="form-control">
                                    <option selected>Round</option>
                                    <option>Rectangular</option>
                                </select>
                            </div>
                            <div class="form-row" id="rectangular-row">
                                <div class="form-group col-md-6">
                                    <label for="width">Width</label>
                                    <input type="number" step="any" class="form-control" placeholder="0" id="width">
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="length">Length</label>
                                    <input type="number" step="any" class="form-control" placeholder="0" id="length">
                                </div>
                            </div>
                            <div class="form-group" id="diameter-row">
                                <label for="diameter">Diamater</label>
                                <input type="number" class="form-control" placeholder="0" step="any" id="diameter">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>Quantity</td>
                        <td colspan=7>
                            <input type="number" class="form-control" placeholder="0" step="any" id="quantity">
                        </td>
                    </tr>
                    <tr>
                        <th>&nbsp;</th>
                        <th class="col-xs-12">&nbsp;</th>
                        <th>grams</th>
                        <th>tsp</th>
                        <th>tbsp</th>
                    </tr>
                    <tr>
                        <td>Flour</td>
                        <td>&nbsp;</td>
                        <td id="flour-gram"></td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>Water</td>
                        <td>
                            <div class="input-group">
                                <input type="number" class="form-control" placeholder="0" step="any" id="water">
                                <div class="input-group-append">
                                    <span class="input-group-text">%</span>
                                </div>
                            </div>
                        </td>
                        <td id="water-gram"></td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>Yeast</td>
                        <td>
                            <div class="input-group">
                                <input type="number" class="form-control" placeholder="0" step="any" id="yeast">
                                <div class="input-group-append">
                                    <span class="input-group-text">%</span>
                                </div>
                            </div>
                        </td>
                        <td id="yeast-gram"></td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>Salt</td>
                        <td>
                            <div class="input-group">
                                <input type="number" class="form-control" placeholder="0" step="any" id="salt">
                                <div class="input-group-append">
                                    <span class="input-group-text">%</span>
                                </div>
                            </div>
                        </td>
                        <td id="salt-gram"></td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>Oil</td>
                        <td>
                            <div class="input-group">
                                <input type="number" class="form-control" placeholder="0" step="any" id="oil">
                                <div class="input-group-append">
                                    <span class="input-group-text">%</span>
                                </div>
                            </div>
                        </td>
                        <td id="oil-gram"></td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>Sugar</td>
                        <td>
                            <div class="input-group">
                                <input type="number" class="form-control" placeholder="0" step="any" id="sugar">
                                <div class="input-group-append">
                                    <span class="input-group-text">%</span>
                                </div>
                            </div>
                        </td>
                        <td id="sugar-gram"></td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>Total (g)</td>
                        <td>&nbsp;</td>
                        <td colspan=6>
                            <div id="total-gram"></div>
                        </td>
                    </tr>
                    <tr>
                        <td>Per ball (g)</td>
                        <td>&nbsp;</td>
                        <td colspan=6>
                            <div id="perball-gram"></div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="row mt-3">
            <div class="card">
            </div>
        </div>
        <div class="row mt-3">
            <div class="card">
                <div class="card-header">
                    Sharing Options
                </div>
                <div class="card-body">
                    <h5 class="card-title">URL</h5>
                    <p class="card-text" id="url"></p>
                    <h5 class="card-title">Table</h5>
                    <p class="card-text" id="table"></p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    <script src="nosleep.min.js"></script>
    <script>
        var noSleep = new NoSleep();
        var wakeLockEnabled = false;
        var toggleEl = document.querySelector("#toggle");
        toggleEl.addEventListener('click', function() {
            if (!wakeLockEnabled) {
                noSleep.enable(); // keep the screen on!
                wakeLockEnabled = true;
                toggleEl.innerHTML = "Wake Lock is enabled";
            } else {
                noSleep.disable(); // let the screen turn off.
                wakeLockEnabled = false;
                toggleEl.innerHTML = "Wake Lock is disabled";
            }
        }, false);
    </script>
    <script>
        let tf = document.getElementById("thicknessFactor");
        let quantity = document.getElementById("quantity");
        let shape = document.getElementById("shape");
        let diameter = document.getElementById("diameter");
        let length = document.getElementById("length");
        let width = document.getElementById("width");
        let water = document.getElementById("water");
        let yeast = document.getElementById("yeast");
        let salt = document.getElementById("salt");
        let oil = document.getElementById("oil");
        let sugar = document.getElementById("sugar");

        let rectangular_row = document.getElementById("rectangular-row");
        let diameter_row = document.getElementById("diameter-row");

        document.addEventListener('input', calc);
        function calc() {
            var total;
            switch(shape.value.toString()) {
              case "Round":
                total = (Math.PI * Math.pow(Number(diameter.value) / 2, 2)) * Number(tf.value) * Number(quantity.value) * 28.35;
                rectangular_row.style.display = "none";
                diameter_row.style.display = null;
                break;
              case "Rectangular":
                total = (Number(width.value) * Number(length.value)) * Number(tf.value) * Number(quantity.value) * 28.35;
                rectangular_row.style.display = null;
                diameter_row.style.display = "none";
                break;
              default:
                total = 0;
            }
            var flour = total / (1 + ((Number(water.value) + Number(yeast.value) + Number(salt.value) + Number(oil.value) + Number(sugar.value)) / 100));
            var total_gram = total;
            var perball_gram = total / Number(quantity.value);
            var flour_gram = flour;
            var water_gram = flour * (Number(water.value) / 100);
            var yeast_gram = flour * (Number(yeast.value) / 100);
            var salt_gram = flour * (Number(salt.value) / 100);
            var oil_gram = flour * (Number(oil.value) / 100);
            var sugar_gram = flour * (Number(sugar.value) / 100);

            //Make the shareable URL
            url = top.location.origin.toString() + top.location.pathname.toString();
            url += "?thicknessFactor=" + Number(tf.value);
            url += "&quantity=" + Number(quantity.value);
            url += "&water=" + Number(water.value);
            url += "&yeast=" + Number(yeast.value);
            url += "&salt=" + Number(salt.value);
            url += "&sugar=" + Number(sugar.value);
            url += "&oil=" + Number(oil.value);
            url += "&shape=" + shape.value;
            switch(shape.value.toString()) {
                case "Round":
                    url += "&diameter=" + Number(diameter.value)
                    break;
                case "Rectangular":
                    url += "&length=" + Number(length.value);
                    url += "&width=" + Number(width.value);
                    break;
                default:
                    break;
            }
            document.getElementById("url").innerHTML = "<a href='" + url + "'>" + url + "</a>";

            //Make a shareable table
            document.getElementById("table").innerHTML = `
                <table>
                    <tr>
                        <td>Flour</td>
                        <td>${flour_gram.toFixed(2)}g</td>
                    </tr>
                    <tr>
                        <td>Water (${Number(water.value)}%)</td>
                        <td>${water_gram.toFixed(2)}g</td>
                    </tr>
                    <tr>
                        <td>Yeast (${Number(yeast.value)}%)</td>
                        <td>${yeast_gram.toFixed(2)}g</td>
                    </tr>
                    <tr>
                        <td>Salt (${Number(salt.value)}%)</td>
                        <td>${salt_gram.toFixed(2)}g</td>
                    </tr>
                    <tr>
                        <td>Oil (${Number(oil.value)}%)</td>
                        <td>${oil_gram.toFixed(2)}g</td>
                    </tr>
                    <tr>
                        <td>Sugar (${Number(sugar.value)}%)</td>
                        <td>${sugar_gram.toFixed(2)}g</td>
                    </tr>
                </table>

            `;

            //Update the main table
            document.getElementById("total-gram").innerHTML = total_gram.toFixed(2);
            document.getElementById("perball-gram").innerHTML = perball_gram.toFixed(2);
            document.getElementById("flour-gram").innerHTML = flour_gram.toFixed(2);
            document.getElementById("water-gram").innerHTML = water_gram.toFixed(2);
            document.getElementById("yeast-gram").innerHTML = yeast_gram.toFixed(2);
            document.getElementById("salt-gram").innerHTML = salt_gram.toFixed(2);
            document.getElementById("oil-gram").innerHTML = oil_gram.toFixed(2);
            document.getElementById("sugar-gram").innerHTML = sugar_gram.toFixed(2);
        }

        document.addEventListener("DOMContentLoaded", function(e) {
            var url = new URL(window.location.href);
            var query_string = url.search;
            var search_params = new URLSearchParams(query_string);

            thicknessFactor.value = (search_params.get('thicknessFactor') == null) ? 0.075 : search_params.get('thicknessFactor');
            diameter.value = (search_params.get('diameter') == null) ? 11 : search_params.get('diameter');
            shape.value = (search_params.get('shape') == null) ? "Round" : search_params.get('shape');
            length.value = (search_params.get('length') == null) ? 11 : search_params.get('length');
            width.value = (search_params.get('diameter') == null) ? 11 : search_params.get('diameter');
            quantity.value = (search_params.get('quantity') == null) ? 2 : search_params.get('quantity');
            water.value = (search_params.get('water') == null) ? 65 : search_params.get('water');
            yeast.value = (search_params.get('yeast') == null) ? 0.5 : search_params.get('yeast');
            salt.value = (search_params.get('salt') == null) ? 2.5 : search_params.get('salt');
            sugar.value = (search_params.get('sugar') == null) ? 0.0 : search_params.get('sugar');
            oil.value = (search_params.get('oil') == null) ? 0.0 : search_params.get('oil');
            calc();
        });
    </script>
</body>
